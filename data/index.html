<!DOCTYPE html>
<html lang="en">

    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>eGarden</title>



        <link type="image/png" sizes="16x16" rel="icon"
            href="https://img.icons8.com/external-wanicon-flat-wanicon/64/external-garden-food-technology-wanicon-flat-wanicon.png">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
        <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

        <script src="https://cdn.tailwindcss.com"></script>
        <link href="https://cdn.jsdelivr.net/npm/daisyui@4.7.3/dist/full.min.css" rel="stylesheet" type="text/css" />
        <script>
            tailwind.config = {
                theme: {
                    extend: {
                        colors: {
                            clifford: '#da373d',
                        }
                    }
                },
                daisyui: {
                    themes: ['garden'],
                    darkTheme: false,
                    base: true,
                    styled: true,
                    utils: true,
                    prefix: "",
                    logs: true,
                    themeRoot: ":root",
                },

            }
        </script>
        <style>
            .active {
                background-color: #b2fdcb;
                color: #000;
                font-weight: 600;
            }
        </style>
    </head>

    <body data-theme="garden">

        <div class="drawer lg:drawer-open">
            <input id="my-drawer-2" type="checkbox" class="drawer-toggle" />
            <div class="drawer-content">

                <div class="p-8 flex border-b gap-4 border-gray-400">
                    <label for="my-drawer-2" class="btn btn-primary drawer-button lg:hidden"><i class="fas fa-bars"></i>
                    </label>
                    <h1 class="font-extrabold text-3xl" id="title">Dashboard</h1>
                </div>
                <!-- DASHBOARD PAGE -->
                <div id="dashboard">
                    <div class="px-2">
                        <div class="main p-8 grid grid-cols-3 gap-4">
                            <div
                                class="card card-side bg-base-100 shadow-xl max-w-lg border border-blue-300 hover:bg-green-300 hover:scale-105 transition-all ease-in-out duration-300">
                                <figure>
                                    <div class="w-full flex items-center justify-center p-8 text-4xl">
                                        <i class='bx bx-droplet'></i>
                                    </div>
                                </figure>

                                <div class="card-body">
                                    <h2 class="card-title">Humidity</h2>
                                    <p>
                                        <span class="font-bold text-3xl" id="humidity">69</span>
                                        &percnt;
                                    </p>
                                </div>
                            </div>


                            <div
                                class="card card-side bg-base-100 shadow-xl max-w-lg border border-blue-300 hover:bg-green-300 hover:scale-105 transition-all ease-in-out duration-300">
                                <figure>
                                    <div class="w-full flex items-center justify-center p-8 text-4xl">
                                        <i class='bx bx-sun'></i>
                                    </div>
                                </figure>

                                <div class="card-body">
                                    <h2 class="card-title">Temperature</h2>
                                    <p>
                                        <span class="font-bold text-3xl" id="temperature">69</span>
                                        &deg;C
                                    </p>
                                </div>
                            </div>

                            <div
                                class="card card-side bg-base-100 shadow-xl w-full max-w-lg border border-blue-300 hover:bg-green-300 hover:scale-105 transition-all ease-in-out duration-300">
                                <figure>
                                    <div class="w-full flex items-center justify-center p-8 text-4xl">
                                        <i class='bx bx-leaf    '></i>
                                    </div>
                                </figure>

                                <div class="card-body">
                                    <h2 class="card-title">Soil Moisture</h2>
                                    <p>
                                        <span class="font-bold text-3xl" id="moisture">69</span>
                                    </p>
                                </div>
                            </div>

                            <div
                                class="card card-side bg-base-100 shadow-xl max-w-lg border border-blue-300 hover:bg-green-300 hover:scale-105 transition-all ease-in-out duration-300">
                                <figure>
                                    <div class="w-full flex items-center justify-center p-8 text-4xl">
                                        <i class='bx bx-water'></i>
                                    </div>
                                </figure>

                                <div class="card-body">
                                    <h2 class="card-title">Water Value</h2>
                                    <span class="font-bold text-3xl" id="waterValue">69</span>
                                </div>
                            </div>

                            <div
                                class="card card-side bg-base-100 shadow-xl max-w-lg border border-blue-300 hover:bg-green-300 hover:scale-105 transition-all ease-in-out duration-300">
                                <div class="card-body">
                                    <h2 class="card-title">Water Level</h2>
                                    <span class="font-bold text-3xl" id="waterLevel">69</span>
                                </div>
                            </div>
                        </div>
                        <div class="divider"></div>
                    </div>
                </div>

                <!-- GRAPHS PAGE -->
                <div id="graphs" class="hidden">
                    <div class="p-6 grid lg:grid-cols-2 gap-6">
                        <!-- canvas elements for the graphs -->
                        <div class="p-4 bg-base-100 shadow-xl rounded">
                            <h1 class="font-bold text-xl">Temperature</h1>
                            <div class="divider"></div>
                            <canvas id="temperatureChart"></canvas>
                        </div>
                        <div class="p-4 bg-base-100 shadow-xl rounded">
                            <h1 class="font-bold text-xl">Humidity</h1>
                            <div class="divider"></div>
                            <div><canvas id="humidityChart"></canvas></div>
                        </div>
                        <div class="p-4 bg-base-100 shadow-xl rounded">
                            <h1 class="font-bold text-xl">Moisture </h1>
                            <div class="divider"></div>
                            <div><canvas id="moistureChart"></canvas></div>
                        </div>
                        <div class="p-4 bg-base-100 shadow-xl rounded">
                            <h1 class="font-bold text-xl">Water Value</h1>
                            <div class="divider"></div>
                            <div><canvas id="waterValueChart"></canvas></div>
                        </div>
                        <div class="p-4 bg-base-100 shadow-xl rounded">
                            <h1 class="font-bold text-xl">Water Level</h1>
                            <div class="divider"></div>
                            <div><canvas id="waterLevelChart"></canvas></div>
                        </div>
                    </div>
                </div>


            </div>

            <div class="drawer-side px-4 p-10 border-r border-gray-400">
                <div class="px-8 grid place-items-center">
                    <h1 class="font-extrabold text-3xl">eGarden</h1>
                </div>
                <div class="divider"></div>
                <!-- Nav Links -->
                <div class="flex flex-col space-y-4">

                    <button onclick="showDashboard(this)" id="btnDashboard"
                        class="active btn btn-outline hover:bg-green-300 hover:text-black hover:font-extrabold  px-8 p-4 rounded-full flex space-x-2 items-center justify-start">
                        <i class="fas fa-seedling text-green-400"></i>
                        <span>Dashboard</span>
                    </button>

                    <button onclick="showGraphs(this)" id="btnGraphs"
                        class="btn btn-outline hover:bg-green-300 hover:text-black hover:font-extrabold px-8 p-4 rounded-full flex space-x-2 items-center justify-start">
                        <i class="fas fa-chart-line text-blue-400"></i>
                        <span>Graphs</span>
                    </button>
                </div>
            </div>



        </div>



        <script>
            // index.js
            // Get the context of the canvas elements
            var temperatureCtx = document.getElementById('temperatureChart').getContext('2d');
            var humidityCtx = document.getElementById('humidityChart').getContext('2d');
            var moistureCtx = document.getElementById('moistureChart').getContext('2d');
            var waterLevelCtx = document.getElementById('waterLevelChart').getContext('2d');
            var waterValueCtx = document.getElementById('waterValueChart').getContext('2d');

            // Create the chart instances
            var temperatureChart = new Chart(temperatureCtx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'Temperature',
                        data: [],
                        borderColor: 'rgba(255, 99, 132, 1)',
                        fill: true,
                        backgroundColor: 'rgba(255, 99, 132, 0.2)',
                        borderWidth: 3
                    }]
                },
                options: {
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });

            var humidityChart = new Chart(humidityCtx, {
                type: 'bar',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'Humidity',
                        data: [],
                        borderColor: 'rgba(75, 192, 192, 1)',
                        borderWidth: 3
                    }]
                },
                options: {
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });

            var moistureChart = new Chart(moistureCtx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'Moisture',
                        data: [],
                        borderColor: 'rgba(153, 102, 255, 1)',
                        fill: true,
                        backgroundColor: 'rgba(153, 102, 255, 0.2)',
                        borderWidth: 3
                    }]
                },
                options: {
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });

            var waterValueChart = new Chart(waterValueCtx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'Water Value',
                        data: [],
                        borderColor: 'rgba(255, 206, 86, 1)',
                        fill: true,
                        backgroundColor: 'rgba(255, 206, 86, 0.2)',
                        borderWidth: 3
                    }]
                },
                options: {
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });

            var waterLevelCounts = { LOW: 0, MEDIUM: 0, HIGH: 0 };
            var waterLevelChart = new Chart(waterLevelCtx, {
                type: 'doughnut',
                data: {
                    labels: ['LOW', 'MEDIUM', 'HIGH'],
                    datasets: [{
                        data: [waterLevelCounts.LOW, waterLevelCounts.MEDIUM, waterLevelCounts.HIGH],
                        fill: true,
                        backgroundColor: ['rgba(255, 99, 132, 0.2)', 'rgba(255, 159, 64, 0.2)', 'rgba(75, 192, 192, 0.2)'],
                        borderColor: ['rgba(255, 99, 132, 1)', 'rgba(255, 159, 64, 1)', 'rgba(75, 192, 192, 1)'],
                        borderWidth: 3
                    }]
                }
            });

            function showGraphs() {
                var title = document.getElementById('title');
                var dashboard = document.getElementById('dashboard');
                var graphs = document.getElementById('graphs');
                title.innerText = 'Graphs';
                dashboard.style.display = 'none';
                graphs.style.display = 'block';

                // toggle classes on active
                document.getElementById('btnGraphs').classList.add('active');
                document.getElementById('btnDashboard').classList.remove('active');

            }

            function showDashboard() {
                var title = document.getElementById('title');
                var dashboard = document.getElementById('dashboard');
                var graphs = document.getElementById('graphs');
                title.innerText = 'Dashboard';
                dashboard.style.display = 'block';
                graphs.style.display = 'none';

                // toggle tailwind classes on active
                document.getElementById('btnDashboard').classList.add('active');
                document.getElementById('btnGraphs').classList.remove('active');


            }

            function mapWaterLevel(value) {
                switch (value) {
                    case 0:
                        return 'LOW';
                    case 1:
                        return 'MEDIUM';
                    case 2:
                        return 'HIGH';
                    default:
                        return 'N/A';
                }
            }

            function generateFakeData() {
                return {
                    temperature: Math.random() * 40, // random temperature between 0 and 40
                    humidity: Math.random() * 100, // random humidity between 0 and 100
                    moisture: Math.random() * 100, // random moisture between 0 and 100
                    waterLevel: Math.floor(Math.random() * 3), // random water level between 0 and 100
                    waterValue: Math.random() * 100 // random water value between 0 and 100
                };
            }

            function fakeFetch() {
                var data = generateFakeData(); // Use fake data for testing

                // Update HTML elements with received data
                document.getElementById('temperature').innerText = data.temperature.toFixed(2);
                document.getElementById('humidity').innerText = data.humidity.toFixed(2);
                document.getElementById('moisture').innerText = data.moisture.toFixed(2);
                document.getElementById('waterLevel').innerText = mapWaterLevel(data.waterLevel);
                document.getElementById('waterValue').innerText = data.waterValue.toFixed(2);

                // Update the water level count
                waterLevelCounts[mapWaterLevel(data.waterLevel)]++;

                var now = new Date().toLocaleTimeString();
                temperatureChart.data.labels.push(now);
                temperatureChart.data.datasets[0].data.push(data.temperature.toFixed(2));
                humidityChart.data.labels.push(now);
                humidityChart.data.datasets[0].data.push(data.humidity.toFixed(2));
                moistureChart.data.labels.push(now);
                moistureChart.data.datasets[0].data.push(data.moisture.toFixed(2));
                waterValueChart.data.labels.push(now);
                waterValueChart.data.datasets[0].data.push(data.waterValue.toFixed(2));

                // Update the pie chart data
                waterLevelChart.data.datasets[0].data = [waterLevelCounts.LOW, waterLevelCounts.MEDIUM, waterLevelCounts.HIGH];

                temperatureChart.update();
                humidityChart.update();
                moistureChart.update();
                waterValueChart.update();
                waterLevelChart.update();
            }


            function fetchDataAndUpdate() {
                fetch('/data')
                    .then(response => response.json())
                    .then(data => {
                        // Update HTML elements with received data
                        document.getElementById('temperature').innerText = data.temperature.toFixed(2);
                        document.getElementById('humidity').innerText = data.humidity.toFixed(2);
                        document.getElementById('moisture').innerText = data.moisture.toFixed(2);
                        document.getElementById('waterLevel').innerText = mapWaterLevel(data.waterLevel);
                        document.getElementById('waterValue').innerText = data.waterValue.toFixed(2);

                        // Update the water level count
                        waterLevelCounts[mapWaterLevel(data.waterLevel)]++;

                        var now = new Date().toLocaleTimeString();
                        temperatureChart.data.labels.push(now);
                        temperatureChart.data.datasets[0].data.push(data.temperature.toFixed(2));
                        humidityChart.data.labels.push(now);
                        humidityChart.data.datasets[0].data.push(data.humidity.toFixed(2));
                        moistureChart.data.labels.push(now);
                        moistureChart.data.datasets[0].data.push(data.moisture.toFixed(2));
                        waterValueChart.data.labels.push(now);
                        waterValueChart.data.datasets[0].data.push(data.waterValue.toFixed(2));

                        // Update the pie chart data
                        waterLevelChart.data.datasets[0].data = [waterLevelCounts.LOW, waterLevelCounts.MEDIUM, waterLevelCounts.HIGH];

                        temperatureChart.update();
                        humidityChart.update();
                        moistureChart.update();
                        waterValueChart.update();
                        waterLevelChart.update();
                    })
                    .catch(error => {
                        if (error.name !== 'SyntaxError') {
                            console.error(error);
                        }
                    });
            }


            // fetchDataAndUpdate();
            fakeFetch();
            setInterval(fakeFetch, 2000);

        </script>
    </body>

</html>